(function(s,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],o):(s=typeof globalThis<"u"?globalThis:s||self,o(s.EasyReactPayJp={},s.React))})(this,function(s,o){"use strict";var f=Object.defineProperty;var S=(s,o,c)=>o in s?f(s,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):s[o]=c;var t=(s,o,c)=>(S(s,typeof o!="symbol"?o+"":o,c),c);class c{constructor({PayjpSource:e="https://checkout.pay.jp/",publicToken:n,buttonAppendTo:r="",onTokenCreated:p=()=>console.log("token created"),onTokenFailedToCreate:a=()=>console.log("failed to create token"),text:d="\u30AB\u30FC\u30C9\u3067\u652F\u6255\u3046",submitText:T="\u30AB\u30FC\u30C9\u3067\u652F\u6255\u3046",tokenName:i="",previousToken:m="",lang:y="ja",namePlaceholder:l="TARO YAMADA",tenant:k="",partial:_=!0}){t(this,"_PayjpSource");t(this,"_publicToken");t(this,"_buttonAppendTo");t(this,"_onTokenCreated");t(this,"_onTokenFailedToCreate");t(this,"_text");t(this,"_submitText");t(this,"_tokenName");t(this,"_previousToken");t(this,"_lang");t(this,"_namePlaceholder");t(this,"_tenant");t(this,"_partial");this.PayjpSource=e,this.publicToken=n,this.buttonAppendTo=r,this.onTokenCreated=p,this.onTokenFailedToCreate=a,this.text=d,this.submitText=T,this.tokenName=i,this.previousToken=m,this.lang=y,this.namePlaceholder=l,this.tenant=k,this.partial=_,this.setCallBackToWindow()}get PayjpSource(){return this._PayjpSource}set PayjpSource(e){this._PayjpSource=e}get publicToken(){return this._publicToken}set publicToken(e){this._publicToken=e}get buttonAppendTo(){return this._buttonAppendTo}set buttonAppendTo(e){this._buttonAppendTo=e}get onTokenCreated(){return this._onTokenCreated}set onTokenCreated(e){this._onTokenCreated=e}get onTokenFailedToCreate(){if(!this.partial){console.warn("unable to call this callback. partial needs to be set to true");return}return this._onTokenFailedToCreate}set onTokenFailedToCreate(e){this._onTokenFailedToCreate=e}get text(){return this._text}set text(e){this._text=e}get submitText(){return this._submitText}set submitText(e){this._submitText=e}get tokenName(){return this._tokenName}set tokenName(e){this._tokenName=e}get previousToken(){return this._previousToken}set previousToken(e){this._previousToken=e}get lang(){return this._lang||"ja"}set lang(e){this._lang=e}get namePlaceholder(){return this._namePlaceholder}set namePlaceholder(e){this._namePlaceholder=e}get tenant(){return this._tenant}set tenant(e){this._tenant=e}get partial(){return this._partial}set partial(e){this._partial=e}mountButton(){var n;const e=document.createElement("script");e.src=this.PayjpSource,e.classList.add("payjp-button"),this.getAttributeList().forEach(r=>{e.dataset[r]=this[r]}),e.dataset.key=this.publicToken,e.dataset.onCreated="payjpServiceOnTokenCreated",e.dataset.onFailed="payjpServiceonTokenFailedToCreate",(n=document.getElementById(this.buttonAppendTo))==null||n.appendChild(e)}setCallBackToWindow(){window.payjpServiceOnTokenCreated=this.onTokenCreated,window.payjpServiceonTokenFailedToCreate=this.onTokenFailedToCreate}getAttributeList(e=!1){const n=Object.getOwnPropertyNames(this).filter(r=>!["_payjpSource","_onTokenCreated","_onTokenFailedToCreate"].includes(r));return e?n:n.map(r=>r.replace("_",""))}}class j{constructor({formAppendTo:e="Payjp-v2",PayjpV2Source:n="https://js.pay.jp/v2/pay.js"}){t(this,"_formAppendTo");t(this,"_PayjpV2Source");t(this,"_publicToken");t(this,"_onTokenCreated");t(this,"_onNumberFormInputChange");t(this,"_scriptId","Payjp-v2-script");t(this,"_Payjp");t(this,"_elements");t(this,"card");this.formAppendTo=e,this.PayjpV2Source=n}get formAppendTo(){return this._formAppendTo}set formAppendTo(e){this._formAppendTo=e}get PayjpV2Source(){return this._PayjpV2Source}set PayjpV2Source(e){this._PayjpV2Source=e}get publicToken(){return this._publicToken}set publicToken(e){this._publicToken=e}get onTokenCreated(){return this._onTokenCreated}set onTokenCreated(e){this._onTokenCreated=e}get onNumberFormInputChange(){return this._onNumberFormInputChange}set onNumberFormInputChange(e){this._onNumberFormInputChange=e}get scriptId(){return this._scriptId}set scriptId(e){this._scriptId=e}get Payjp(){return this._Payjp}set Payjp(e){this._Payjp=e}get elements(){return this._elements}set elements(e){this._elements=e}init({publicToken:e,onTokenCreated:n=()=>console.log("token created"),onNumberFormInputChange:r=p=>console.log("input changed")}){this.publicToken=e,this.onTokenCreated=n,this.onNumberFormInputChange=r}createScript(e){return new Promise((n,r)=>{if(document.getElementById(this.scriptId)){const a=document.createElement("script");a.src=this.PayjpV2Source,a.id=this.scriptId,document.head.appendChild(a),a.onload=d=>{e&&e(),n(!0)}}})}createElements(){try{this.Payjp=Payjp(this.publicToken),this.elements=this.Payjp.elements()}catch(e){console.warn(e)}}mountForm(e){const n=this.elements.create(e.name,{style:e.style});n.mount(`#${e.id}`),e.name,this.card=n,n.on("change",this.onNumberFormInputChange)}submit(){this.Payjp.createToken(this.card).then(e=>{const n=document==null?void 0:document.getElementById("Payjp-v2-token");n.innerText=e.error?e.error.message:e.id})}}const C=({PayjpSource:u,publicToken:e,onTokenCreated:n,onTokenFailedToCreate:r,text:p,submitText:a,tokenName:d,previousToken:T,lang:i,namePlaceholder:m,tenant:y,partial:l})=>{const[k,_]=o.useState(!1),P=new c({PayjpSource:u,publicToken:e,buttonAppendTo:"payjpService",onTokenCreated:()=>console.info("token created"),onTokenFailedToCreate:()=>console.info("error"),text:p,submitText:a,tokenName:d,previousToken:T,lang:i,namePlaceholder:m,tenant:y,partial:l});return o.useEffect(()=>{k&&P.mountButton()},[k]),{setIsPayjpReady:_}},g=u=>u==null?!1:typeof u[Symbol.iterator]=="function",h=new j({}),b=({publicToken:u,buttonText:e,onTokenCreated:n,onNumberFormInputChange:r})=>{const[p,a]=o.useState(!1),[d,T]=o.useState(!1),[i,m]=o.useState([]);return o.useEffect(()=>{p&&(h.init({publicToken:u,onTokenCreated:n,onNumberFormInputChange:r}),(async()=>(await h.createScript(),h.createElements(),T(!0)))())},[p]),o.useEffect(()=>{if(d){if(!i){console.warn("need to pass at least one card form");return}(g(i)?i:[i]).forEach(l=>{h.mountForm({name:l.props.name,id:l.props.id,style:l.props.style})})}},[i,d]),{setIsPayjpReady:a,payjp:h,buttonText:e,setChildren:m}};s.usePayjpCheckout=C,s.usePayjpV2=b,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
