(function(a,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],o):(a=typeof globalThis<"u"?globalThis:a||self,o(a.EasyReactPayJp={},a.React))})(this,function(a,o){"use strict";var A=Object.defineProperty;var I=(a,o,d)=>o in a?A(a,o,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[o]=d;var n=(a,o,d)=>(I(a,typeof o!="symbol"?o+"":o,d),d);const h=(s=>s&&typeof s=="object"&&"default"in s?s:{default:s})(o);class f{constructor({PayjpSource:e="https://checkout.pay.jp/",publicToken:t,buttonAppendTo:r="",onTokenCreated:i=()=>console.log("token created"),onTokenFailedToCreate:u=()=>console.log("failed to create token"),text:c="\u30AB\u30FC\u30C9\u3067\u652F\u6255\u3046",submitText:T="\u30AB\u30FC\u30C9\u3067\u652F\u6255\u3046",tokenName:p="",previousToken:y="",lang:k="ja",namePlaceholder:l="TARO YAMADA",tenant:_="",partial:j=!0}){n(this,"_PayjpSource");n(this,"_publicToken");n(this,"_buttonAppendTo");n(this,"_onTokenCreated");n(this,"_onTokenFailedToCreate");n(this,"_text");n(this,"_submitText");n(this,"_tokenName");n(this,"_previousToken");n(this,"_lang");n(this,"_namePlaceholder");n(this,"_tenant");n(this,"_partial");this.PayjpSource=e,this.publicToken=t,this.buttonAppendTo=r,this.onTokenCreated=i,this.onTokenFailedToCreate=u,this.text=c,this.submitText=T,this.tokenName=p,this.previousToken=y,this.lang=k,this.namePlaceholder=l,this.tenant=_,this.partial=j,this.setCallBackToWindow()}get PayjpSource(){return this._PayjpSource}set PayjpSource(e){this._PayjpSource=e}get publicToken(){return this._publicToken}set publicToken(e){this._publicToken=e}get buttonAppendTo(){return this._buttonAppendTo}set buttonAppendTo(e){this._buttonAppendTo=e}get onTokenCreated(){return this._onTokenCreated}set onTokenCreated(e){this._onTokenCreated=e}get onTokenFailedToCreate(){if(!this.partial){console.warn("unable to call this callback. partial needs to be set to true");return}return this._onTokenFailedToCreate}set onTokenFailedToCreate(e){this._onTokenFailedToCreate=e}get text(){return this._text}set text(e){this._text=e}get submitText(){return this._submitText}set submitText(e){this._submitText=e}get tokenName(){return this._tokenName}set tokenName(e){this._tokenName=e}get previousToken(){return this._previousToken}set previousToken(e){this._previousToken=e}get lang(){return this._lang||"ja"}set lang(e){this._lang=e}get namePlaceholder(){return this._namePlaceholder}set namePlaceholder(e){this._namePlaceholder=e}get tenant(){return this._tenant}set tenant(e){this._tenant=e}get partial(){return this._partial}set partial(e){this._partial=e}mountButton(){var t;const e=document.createElement("script");e.src=this.PayjpSource,e.classList.add("payjp-button"),this.getAttributeList().forEach(r=>{e.dataset[r]=this[r]}),e.dataset.key=this.publicToken,e.dataset.onCreated="payjpServiceOnTokenCreated",e.dataset.onFailed="payjpServiceonTokenFailedToCreate",(t=document.getElementById(this.buttonAppendTo))==null||t.appendChild(e)}setCallBackToWindow(){window.payjpServiceOnTokenCreated=this.onTokenCreated,window.payjpServiceonTokenFailedToCreate=this.onTokenFailedToCreate}getAttributeList(e=!1){const t=Object.getOwnPropertyNames(this).filter(r=>!["_payjpSource","_onTokenCreated","_onTokenFailedToCreate"].includes(r));return e?t:t.map(r=>r.replace("_",""))}}class C{constructor({formAppendTo:e="Payjp-v2",PayjpV2Source:t="https://js.pay.jp/v2/pay.js"}){n(this,"_formAppendTo");n(this,"_PayjpV2Source");n(this,"_publicToken");n(this,"_onTokenCreated");n(this,"_onNumberFormInputChange");n(this,"_scriptId","Payjp-v2-script");n(this,"_Payjp");n(this,"_elements");n(this,"card");this.formAppendTo=e,this.PayjpV2Source=t}get formAppendTo(){return this._formAppendTo}set formAppendTo(e){this._formAppendTo=e}get PayjpV2Source(){return this._PayjpV2Source}set PayjpV2Source(e){this._PayjpV2Source=e}get publicToken(){return this._publicToken}set publicToken(e){this._publicToken=e}get onTokenCreated(){return this._onTokenCreated}set onTokenCreated(e){this._onTokenCreated=e}get onNumberFormInputChange(){return this._onNumberFormInputChange}set onNumberFormInputChange(e){this._onNumberFormInputChange=e}get scriptId(){return this._scriptId}set scriptId(e){this._scriptId=e}get Payjp(){return this._Payjp}set Payjp(e){this._Payjp=e}get elements(){return this._elements}set elements(e){this._elements=e}init({publicToken:e,onTokenCreated:t=()=>console.log("token created"),onNumberFormInputChange:r=i=>console.log("input changed")}){this.publicToken=e,this.onTokenCreated=t,this.onNumberFormInputChange=r}createScript(e){return new Promise((t,r)=>{if(document.getElementById(this.scriptId)){const u=document.createElement("script");u.src=this.PayjpV2Source,u.id=this.scriptId,document.head.appendChild(u),u.onload=c=>{e&&e(),t(!0)}}})}createElements(){try{this.Payjp=Payjp(this.publicToken),this.elements=this.Payjp.elements()}catch(e){console.warn(e)}}mountForm(e){const t=this.elements.create(e.name,{style:e.style});t.mount(`#${e.id}`),e.name,this.card=t,t.on("change",this.onNumberFormInputChange)}submit(){this.Payjp.createToken(this.card).then(e=>{const t=document==null?void 0:document.getElementById("Payjp-v2-token");t.innerText=e.error?e.error.message:e.id})}}const P=({PayjpSource:s,publicToken:e,onTokenCreated:t,onTokenFailedToCreate:r,text:i,submitText:u,tokenName:c,previousToken:T,lang:p,namePlaceholder:y,tenant:k,partial:l})=>{const[_,j]=o.useState(!1),F=new f({PayjpSource:s,publicToken:e,buttonAppendTo:"payjpService",onTokenCreated:()=>console.info("token created"),onTokenFailedToCreate:()=>console.info("error"),text:i,submitText:u,tokenName:c,previousToken:T,lang:p,namePlaceholder:y,tenant:k,partial:l});return o.useEffect(()=>{_&&F.mountButton()},[_]),{setIsPayjpReady:j}},g=s=>s==null?!1:typeof s[Symbol.iterator]=="function",m=new C({}),b=({publicToken:s,buttonText:e,onTokenCreated:t,onNumberFormInputChange:r})=>{const[i,u]=o.useState(!1),[c,T]=o.useState(!1),[p,y]=o.useState([]);return o.useEffect(()=>{i&&(m.init({publicToken:s,onTokenCreated:t,onNumberFormInputChange:r}),(async()=>(await m.createScript(),m.createElements(),T(!0)))())},[i]),o.useEffect(()=>{if(c){if(!p){console.warn("need to pass at least one card form");return}(g(p)?p:[p]).forEach(l=>{m.mountForm({name:l.props.name,id:l.props.id,style:l.props.style})})}},[p,c]),{setIsPayjpReady:u,payjp:m,buttonText:e,setChildren:y}},S=({setIsPayjpReady:s})=>(o.useEffect(()=>{s(!0)},[]),h.default.createElement("div",{id:"payjpService"})),v=({children:s,payjp:e,buttonText:t,setIsPayjpReady:r,setChildren:i})=>(o.useEffect(()=>{r(!0),i(s)},[]),h.default.createElement("div",{id:e.scriptId},h.default.createElement("div",{id:"payjp-v2",className:"payjp-outer"},s,h.default.createElement("button",{onClick:e.submit},t),h.default.createElement("span",{id:"payjp-v2-token"})))),E=({id:s})=>h.default.createElement("div",{id:s});a.PayJpV2Element=E,a.PayjpCheckout=S,a.PayjpV2=v,a.usePayjpCheckout=P,a.usePayjpV2=b,Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
