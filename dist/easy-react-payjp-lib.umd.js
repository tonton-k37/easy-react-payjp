var j=Object.defineProperty;var F=(s,n,u)=>n in s?j(s,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[n]=u;var t=(s,n,u)=>(F(s,typeof n!="symbol"?n+"":n,u),u);(function(s,n){typeof exports=="object"&&typeof module!="undefined"?n(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],n):(s=typeof globalThis!="undefined"?globalThis:s||self,n(s.EasyReactPayJp={},s.React))})(this,function(s,n){"use strict";function u(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var m=u(n);class f{constructor({payJpSource:e="https://checkout.pay.jp/",publicToken:a,buttonAppendTo:r="",onTokenCreated:i=()=>console.log("token created"),onTokenFailedToCreate:d=()=>console.log("failed to create token"),text:l="\u30AB\u30FC\u30C9\u3067\u652F\u6255\u3046",submitText:h="\u30AB\u30FC\u30C9\u3067\u652F\u6255\u3046",tokenName:T="",previousToken:p="",lang:k="ja",namePlaceholder:c="TARO YAMADA",tenant:_="",partial:y=!0}){t(this,"_payJpSource");t(this,"_publicToken");t(this,"_buttonAppendTo");t(this,"_onTokenCreated");t(this,"_onTokenFailedToCreate");t(this,"_text");t(this,"_submitText");t(this,"_tokenName");t(this,"_previousToken");t(this,"_lang");t(this,"_namePlaceholder");t(this,"_tenant");t(this,"_partial");this.payJpSource=e,this.publicToken=a,this.buttonAppendTo=r,this.onTokenCreated=i,this.onTokenFailedToCreate=d,this.text=l,this.submitText=h,this.tokenName=T,this.previousToken=p,this.lang=k,this.namePlaceholder=c,this.tenant=_,this.partial=y,this.setCallBackToWindow()}get payJpSource(){return this._payJpSource}set payJpSource(e){this._payJpSource=e}get publicToken(){return this._publicToken}set publicToken(e){this._publicToken=e}get buttonAppendTo(){return this._buttonAppendTo}set buttonAppendTo(e){this._buttonAppendTo=e}get onTokenCreated(){return this._onTokenCreated}set onTokenCreated(e){this._onTokenCreated=e}get onTokenFailedToCreate(){if(!this.partial){console.warn("unable to call this callback. partial needs to be set to true");return}return this._onTokenFailedToCreate}set onTokenFailedToCreate(e){this._onTokenFailedToCreate=e}get text(){return this._text}set text(e){this._text=e}get submitText(){return this._submitText}set submitText(e){this._submitText=e}get tokenName(){return this._tokenName}set tokenName(e){this._tokenName=e}get previousToken(){return this._previousToken}set previousToken(e){this._previousToken=e}get lang(){return this._lang||"ja"}set lang(e){this._lang=e}get namePlaceholder(){return this._namePlaceholder}set namePlaceholder(e){this._namePlaceholder=e}get tenant(){return this._tenant}set tenant(e){this._tenant=e}get partial(){return this._partial}set partial(e){this._partial=e}mountButton(){var a;const e=document.createElement("script");e.src=this.payJpSource,e.classList.add("payjp-button"),this.getAttributeList().forEach(r=>{e.dataset[r]=this[r]}),e.dataset.key=this.publicToken,e.dataset.onCreated="payJpServiceOnTokenCreated",e.dataset.onFailed="payJpServiceonTokenFailedToCreate",(a=document==null?void 0:document.getElementById(this.buttonAppendTo))==null||a.appendChild(e)}setCallBackToWindow(){window.payJpServiceOnTokenCreated=this.onTokenCreated,window.payJpServiceonTokenFailedToCreate=this.onTokenFailedToCreate}getAttributeList(e=!1){const a=Object.getOwnPropertyNames(this).filter(r=>!["_payJpSource","_onTokenCreated","_onTokenFailedToCreate"].includes(r));return e?a:a.map(r=>r.replace("_",""))}}class b{constructor({formAppendTo:e="payjp-v2",payJpV2Source:a="https://js.pay.jp/v2/pay.js",publicToken:r,onTokenCreated:i=()=>console.log("token created"),onNumberFormInputChange:d=l=>console.log("input changed")}){t(this,"_formAppendTo");t(this,"_payJpV2Source");t(this,"_publicToken");t(this,"_onTokenCreated");t(this,"_onNumberFormInputChange");t(this,"_scriptId","payjp-v2-script");t(this,"_payjp");t(this,"_elements");t(this,"card");this.formAppendTo=e,this.payJpV2Source=a,this.publicToken=r,this.onTokenCreated=i,this.onNumberFormInputChange=d,this.submit=this.submit.bind(this)}get formAppendTo(){return this._formAppendTo}set formAppendTo(e){this._formAppendTo=e}get payJpV2Source(){return this._payJpV2Source}set payJpV2Source(e){this._payJpV2Source=e}get publicToken(){return this._publicToken}set publicToken(e){this._publicToken=e}get onTokenCreated(){return this._onTokenCreated}set onTokenCreated(e){this._onTokenCreated=e}get onNumberFormInputChange(){return this._onNumberFormInputChange}set onNumberFormInputChange(e){this._onNumberFormInputChange=e}get scriptId(){return this._scriptId}set scriptId(e){this._scriptId=e}get payjp(){return this._payjp}set payjp(e){this._payjp=e}get elements(){return this._elements}set elements(e){this._elements=e}createScript(e){if(!document.getElementById(this.scriptId)){const r=document.createElement("script");r.src=this.payJpV2Source,r.id=this.scriptId,r.type="module",document.head.appendChild(r),r.onload=i=>{e&&e()}}}createElements(){try{this.payjp=Payjp(this.publicToken),this.elements=this.payjp.elements()}catch(e){console.warn(e)}}mountForm(e){const a=this.elements.create(e.name,{style:e.style});a.mount(`#${e.id}`),e.name,this.card=a,a.on("change",this.onNumberFormInputChange)}submit(){this.payjp.createToken(this.card).then(e=>{const a=document==null?void 0:document.getElementById("payjp-v2-token");a.innerText=e.error?e.error.message:e.id})}}const C=({payJpSource:o,publicToken:e,onTokenCreated:a,onTokenFailedToCreate:r,text:i,submitText:d,tokenName:l,previousToken:h,lang:T,namePlaceholder:p,tenant:k,partial:c})=>{const[_,y]=n.useState(!1),J=new f({payJpSource:o,publicToken:e,buttonAppendTo:"payjpService",onTokenCreated:()=>console.info("token created"),onTokenFailedToCreate:()=>console.info("error"),text:i,submitText:d,tokenName:l,previousToken:h,lang:T,namePlaceholder:p,tenant:k,partial:c});return n.useEffect(()=>{y(!0)},[]),n.useEffect(()=>{_&&J.mountButton()},[_]),m.default.createElement("div",{id:"payjpService"})},g=o=>o==null?!1:typeof o[Symbol.iterator]=="function",S=({children:o,publicToken:e,buttonText:a,onTokenCreated:r,onNumberFormInputChange:i})=>{const[d,l]=n.useState(!1),[h,T]=n.useState(!1),p=new b({publicToken:e,onTokenCreated:r,onNumberFormInputChange:i});return n.useEffect(()=>{l(!0),p.createScript(()=>T(!0))},[]),n.useEffect(()=>{if(h){if(p.createElements(),!o){console.warn("need to pass at least one card form");return}(g(o)?o:[o]).forEach(c=>{p.mountForm({name:c.props.name,id:c.props.id,style:c.props.style})})}},[h]),m.default.createElement("div",{id:"payjp-v2",className:"payjp-outer"},o,m.default.createElement("button",{onClick:p.submit},a),m.default.createElement("span",{id:"payjp-v2-token"}))},v=({id:o})=>m.default.createElement("div",{id:o});s.PayJpCheckOut=C,s.PayJpV2=S,s.PayJpV2Element=v,Object.defineProperties(s,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
